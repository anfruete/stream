var player1,uuid,useHLS=!1;function startRender(){const e=document.querySelector("video");var t=vidSource,o=window.location.href;if(uuid=o.includes("?uid=")?o.split("?uid=")[1]:o.includes("#uid=")?o.split("#uid=")[1]:t,void 0===t)return void shownotif("Currently unavailable, try other stream");if(t.includes(".m3u8")&&(useHLS=!0),"ontouchstart"in window||navigator.maxTouchPoints)if(window.innerWidth>935)r={controls:!0,seek:!0},n=["play-large","rewind","play","fast-forward","progress","current-time","duration","mute","volume","settings","pip","airplay","fullscreen"];else r={controls:!1,seek:!0},n=["play-large","rewind","play","fast-forward","progress","current-time","duration","settings","pip","airplay","fullscreen"];else var r={controls:!0,seek:!0},n=["play-large","play","progress","current-time","duration","mute","volume","settings","pip","airplay","fullscreen"];const i={i18n:{play:"Play (K)",pause:"Pause (K)",mute:"Mute (M)",unmute:"Unmute (M)",enterFullscreen:"Enter fullscreen (F)",exitFullscreen:"Exit fullscreen (F)"},controls:n,tooltips:r,seekTime:5,keyboard:{focused:!0,global:!0},fullscreen:{iosNative:!0}};if(setTimeout((()=>{document.getElementById("videocontainer").style.display="block"}),5e3),Hls.isSupported()&&useHLS){const o=new Hls;o.loadSource(t),o.on(Hls.Events.MANIFEST_PARSED,(function(t,r){var n=o.levels.map((e=>e.height));n.push(0);const a=n.reverse();if(i.quality={default:a[0],options:a,forced:!0,onChange:e=>function(e){if(window.hls.levels.forEach(((t,o)=>{t.height===e?window.hls.currentLevel=o:0===e&&(window.hls.currentLevel=-1)})),isStorage("sessionStorage")&&!skipStore){var t=sessionStorage.getItem("quality");e!==t&&(sessionStorage.setItem("quality",e),sessionStorage.setItem("timeq",Date.now()))}}(e)},skipStore=!0,player1=new Plyr(e,i),plyrSetup(),isStorage("sessionStorage")){var s=sessionStorage.getItem("quality"),l=Date.now()-parseInt(sessionStorage.getItem("timeq"));!isNaN(s)&&l<432e5?player1.quality=parseInt(s):player1.quality=0}else player1.quality=0;skipStore=!1})),o.on(Hls.Events.ERROR,(function(e,r){!0===r.fatal&&(r.type===Hls.ErrorTypes.NETWORK_ERROR?(console.log("network error on hls load, retrying..."),setTimeout((()=>{++trycount<3?(setTimeout((()=>{checkvideo(t)}),500),o.recoverMediaError(),player1.play()):void 0!==player1&&player1.playing||shownotif("Network error<br>Try reload or use other stream",6e5)}),100)):r.type===Hls.ErrorTypes.MEDIA_ERROR&&(console.log("media error, recovering..."),o.recoverMediaError(),player1.play()))})),o.attachMedia(e),window.hls=o}else{if(player1=new Plyr(e,i),plyrSetup(),player1.source={type:"video",sources:[{src:t}]},useHLS)(t=document.getElementsByTagName("source")[0]).addEventListener("error",(function(e){if(++tryAttempt<4){var t=document.getElementsByTagName("video")[0];console.log("Reloading video..."),t.load(),t.play()}else shownotif("Your browser doesn't support this stream<br>try change player or server",6e5)}),!0)}window.addEventListener("message",handleMsg,!1)}var skipStore=!1,trycount=0,tryAttempt=0;function plyrSetup(){document.getElementById("videocontainer").style.display="block",window.addEventListener("orientationchange",(function(){Math.abs(window.orientation)>45&&Math.abs(window.orientation)<135?player1.fullscreen.enter():player1.fullscreen.exit()})),player1.on("seeking",(e=>{window.innerWidth<935&&seekFast()})),void 0!==screen.orientation&&(player1.on("enterfullscreen",(e=>{screen.orientation.lock("landscape").catch((function(e){}))})),player1.on("exitfullscreen",(e=>{screen.orientation.unlock()}))),player1.on("ended",(e=>{player1.duration>1200&&player1.currentTime>player1.duration-1&&window.parent.postMessage("episode#forward","*")})),player1.on("error",(e=>{if(!useHLS){var t=document.getElementsByTagName("video")[0];console.log("Error occured, reloading video..."),t.load()}})),document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||(player1.on("enterfullscreen",(e=>{window.parent.postMessage("fallback#fullscreen","*")})),player1.on("exitfullscreen",(e=>{window.parent.postMessage("fallback#exitfull","*")}))),document.addEventListener("keyup",(e=>{e.shiftKey&&"ArrowRight"===e.key&&player1.forward(80),e.shiftKey&&"ArrowLeft"===e.key&&player1.rewind(80),"]"===e.key&&window.parent.postMessage("episode#forward","*"),"["===e.key&&window.parent.postMessage("episode#backward","*"),"l"!==e.key&&"L"!==e.key||window.parent.postMessage("light#toggle","*")}),!1),player1.on("playing",(e=>{if(playfirsttime&&isStorage("localStorage")){var t=localStorage.getItem("playback-"+uuid);null!==t&&(t=parseFloat(t),player1.duration-60>t&&(player1.currentTime=t)),playfirsttime=!1}SSdisplayed&&screenshoot(),document.getElementById("notif").style.display="none"})),timeMonitor(),(player1.muted||player1.volume<.1)&&(player1.muted=!1,player1.volume=1),player1.speed=1}var monitorInterval,playfirsttime=!0;function timeMonitor(){isStorage("localStorage")&&(monitorInterval=setInterval((()=>{!playfirsttime&&player1.playing&&localStorage.setItem("playback-"+uuid,player1.currentTime)}),2e3))}var seekLastTime,seeking=0;function seekFast(){seekLastTime<player1.currentTime?(1===seeking&&player1.forward(70),seeking=1):seekLastTime>player1.currentTime&&(2===seeking&&player1.rewind(70),seeking=2),seekLastTime=player1.currentTime,setTimeout((()=>{seeking=0}),400)}var videochecked=!1;function checkvideo(e){if(!videochecked&&void 0===player1&&navigator.onLine){videochecked=!0;var t=new XMLHttpRequest;t.open("GET",e),t.timeout=5e3,t.onerror=function(){shownotif("Video expired.<br>Try again later",12e4)},t.send()}}function handleMsg(e){"Success"===e.data?document.getElementById("notif").style.opacity=0:"screenshot"===e.data&&screenshoot()}var SSdisplayed=!1,SSlocked=!1;function screenshoot(){if(!SSlocked){var e,t;if(SSlocked=!0,SSdisplayed)return e=document.getElementById("howtosave"),(t=document.getElementsByTagName("canvas")[0]).style.opacity="0",e.style.opacity="0",setTimeout((()=>{t.remove(),e.remove(),SSlocked=!1}),500),void(SSdisplayed=!1);(e=document.createElement("div")).style.cssText="opacity:0;position:fixed;width:30%;bottom:5px;right:5px;transition:all 0.4s ease;background-color:rgba(0,0,0,0.5);text-align:center;color:white;z-index:99;font-size:12px;",e.innerText="Right click image to save",e.id="howtosave",document.body.appendChild(e);var o=document.getElementsByTagName("video")[0];(t=document.createElement("canvas")).style.cssText="position:fixed; width:100%; box-shadow:0px 2px 5px 2px #131313c7; bottom:0; right:0; transition: all 0.4s ease; opacity:1",t.width=o.videoWidth,t.height=o.videoHeight,t.getContext("2d").drawImage(o,0,0,t.width,t.height),document.body.appendChild(t),setTimeout((()=>{t.style.width="30%",t.style.bottom="5px",t.style.right="5px"}),50),setTimeout((()=>{e.style.opacity="1",SSlocked=!1}),450),SSdisplayed=!0}}function shownotif(e,t=4e5){var o=document.getElementById("notif");o.innerHTML=e,o.style.display="block",setTimeout((function(){o.style.display="none"}),t)}function isStorage(e){try{var t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}}function dec64(e){if(void 0===e||""===e.trim())return!1;try{return atob(e)}catch(e){return!1}}
